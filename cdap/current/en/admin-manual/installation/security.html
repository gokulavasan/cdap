<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Cask Data, Inc." name="author" />
<meta content="Copyright © 2014 Cask Data, Inc." name="copyright" />
<script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-55081520-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <title>CDAP Security &mdash; Cask Data Application Platform 2.5.2 Documentation</title>
    
    <link rel="stylesheet" href="../_static/cdap.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    



    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.5.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Cask Data Application Platform 2.5.2 Documentation" href="../index.html" />
    <link rel="up" title="Installation" href="index.html" />
    <link rel="next" title="Monitoring CDAP" href="monitoring.html" />
    <link rel="prev" title="Installation and Configuration" href="installation.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="monitoring.html" title="Monitoring CDAP"
             accesskey="N">Next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation and Configuration"
             accesskey="P">Previous</a> |</li>
        <li><a href="../table-of-contents.html">CDAP Administration Manual</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Installation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="cdap-security">
<span id="configuration-security"></span><h1>CDAP Security<a class="headerlink" href="#cdap-security" title="Permalink to this headline">¶</a></h1>
<p>Cask Data Application Platform (CDAP) supports securing clusters using perimeter
security. Here, we’ll discuss how to setup a secure CDAP instance.</p>
<p>Additional security information, including client APIs and the authentication process, is covered
in the Developers’ Manual <a class="reference external" href="../source/../../developers-manual/security/index.html#security-index" title="(in Cask Data Application Platform v2.5.2)"><em>Security</em></a> section.</p>
<p>We recommend that in order for CDAP to be secure, CDAP security should always be used in conjunction with
<a class="reference external" href="http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/SecureMode.html">secure Hadoop clusters</a>.
In cases where secure Hadoop is not or cannot be used, it is inherently insecure and any applications
running on the cluster are effectively &#8220;trusted”. Though there is still value in having the perimeter access
be authenticated in that situation, whenever possible a secure Hadoop cluster should be employed with CDAP security.</p>
<p>CDAP Security is configured in <tt class="docutils literal"><span class="pre">cdap-site.xml</span></tt> and <tt class="docutils literal"><span class="pre">cdap-security.xml</span></tt>:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">cdap-site.xml</span></tt> has non-sensitive information, such as the type of authentication mechanism and their configuration.</li>
<li><tt class="docutils literal"><span class="pre">cdap-security.xml</span></tt> is used to store sensitive information such as keystore passwords and
SSL certificate keys. It should be owned and readable only by the CDAP user.</li>
</ul>
<p>These files are shown in <a class="reference internal" href="cdap-site.html#appendix-cdap-site-xml"><em>Appendix: cdap-site.xml</em></a> and <a class="reference internal" href="cdap-security.html#appendix-cdap-security-xml"><em>Appendix: cdap-security.xml</em></a>.</p>
<div class="section" id="enabling-security">
<span id="id1"></span><h2>Enabling Security<a class="headerlink" href="#enabling-security" title="Permalink to this headline">¶</a></h2>
<p>To enable security in CDAP, add these properties to <tt class="docutils literal"><span class="pre">cdap-site.xml</span></tt>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>security.enabled</td>
<td>true</td>
</tr>
<tr class="row-odd"><td>security.auth.server.address</td>
<td>&lt;hostname&gt;</td>
</tr>
</tbody>
</table>
<div class="section" id="configuring-kerberos-required">
<h3>Configuring Kerberos (required)<a class="headerlink" href="#configuring-kerberos-required" title="Permalink to this headline">¶</a></h3>
<p>To configure Kerberos authentication for various CDAP services, add these properties to <tt class="docutils literal"><span class="pre">cdap-site.xml</span></tt>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="20%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Default Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>kerberos.auth.enabled</td>
<td><tt class="docutils literal"><span class="pre">security.enabled</span></tt></td>
<td>true to enable Kerberos authentication</td>
</tr>
<tr class="row-odd"><td>cdap.master.kerberos.keytab</td>
<td>None</td>
<td>Kerberos keytab file location</td>
</tr>
<tr class="row-even"><td>cdap.master.kerberos.principal</td>
<td>None</td>
<td>Kerberos principal associated with
the keytab</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configuring-zookeeper-required">
<h3>Configuring Zookeeper (required)<a class="headerlink" href="#configuring-zookeeper-required" title="Permalink to this headline">¶</a></h3>
<p>To configure Zookeeper to enable SASL authentication, add the following to your <tt class="docutils literal"><span class="pre">zoo.cfg</span></tt>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">authProvider</span><span class="o">.</span><span class="mi">1</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">zookeeper</span><span class="o">.</span><span class="na">server</span><span class="o">.</span><span class="na">auth</span><span class="o">.</span><span class="na">SASLAuthenticationProvider</span>
<span class="n">jaasLoginRenew</span><span class="o">=</span><span class="mi">3600000</span>
<span class="n">kerberos</span><span class="o">.</span><span class="na">removeHostFromPrincipal</span><span class="o">=</span><span class="kc">true</span>
<span class="n">kerberos</span><span class="o">.</span><span class="na">removeRealmFromPrincipal</span><span class="o">=</span><span class="kc">true</span>
</pre></div>
</div>
<p>This will let Zookeeper use the <tt class="docutils literal"><span class="pre">SASLAuthenticationProvider</span></tt> as an auth provider, and the <tt class="docutils literal"><span class="pre">jaasLoginRenew</span></tt> line
will cause the Zookeeper server to renew its Kerberos ticket once an hour.</p>
<p>Then, create a <tt class="docutils literal"><span class="pre">jaas.conf</span></tt> file for your Zookeeper server:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">Server</span> <span class="o">{</span>
     <span class="n">com</span><span class="o">.</span><span class="na">sun</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">auth</span><span class="o">.</span><span class="na">module</span><span class="o">.</span><span class="na">Krb5LoginModule</span> <span class="n">required</span>
     <span class="n">useKeyTab</span><span class="o">=</span><span class="kc">true</span>
     <span class="n">keyTab</span><span class="o">=</span><span class="s">&quot;/path/to/zookeeper.keytab&quot;</span>
     <span class="n">storeKey</span><span class="o">=</span><span class="kc">true</span>
     <span class="n">useTicketCache</span><span class="o">=</span><span class="kc">false</span>
     <span class="n">principal</span><span class="o">=</span><span class="s">&quot;&lt;your-zookeeper-principal&gt;&quot;</span><span class="o">;</span>
<span class="o">};</span>
</pre></div>
</div>
<p>The keytab file must be readable by the Zookeeper server, and <tt class="docutils literal"><span class="pre">&lt;your-zookeeper-principal&gt;</span></tt> must correspond
to the keytab file.</p>
<p>Finally, start Zookeeper server with the following JVM option:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="o">-</span><span class="n">Djava</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">auth</span><span class="o">.</span><span class="na">login</span><span class="o">.</span><span class="na">config</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">jaas</span><span class="o">.</span><span class="na">conf</span>
</pre></div>
</div>
</div>
<div class="section" id="running-servers-with-ssl">
<h3>Running Servers with SSL<a class="headerlink" href="#running-servers-with-ssl" title="Permalink to this headline">¶</a></h3>
<p>To enable running servers with SSL in CDAP, add this property to <tt class="docutils literal"><span class="pre">cdap-site.xml</span></tt>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ssl.enabled</td>
<td>true</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="default-ports">
<h3>Default Ports<a class="headerlink" href="#default-ports" title="Permalink to this headline">¶</a></h3>
<p>Without SSL:</p>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Default Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>router.bind.port</td>
<td>10000</td>
</tr>
<tr class="row-odd"><td>security.auth.server.bind.port</td>
<td>10009</td>
</tr>
<tr class="row-even"><td>dashboard.bind.port</td>
<td>9999</td>
</tr>
</tbody>
</table>
<p>With SSL:</p>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Default Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>router.ssl.bind.port</td>
<td>10443</td>
</tr>
<tr class="row-odd"><td>security.auth.server.ssl.bind.port</td>
<td>10010</td>
</tr>
<tr class="row-even"><td>dashboard.ssl.bind.port</td>
<td>9443</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configuring-ssl-for-the-authentication-server">
<h3>Configuring SSL for the Authentication Server<a class="headerlink" href="#configuring-ssl-for-the-authentication-server" title="Permalink to this headline">¶</a></h3>
<p>To configure the granting of <tt class="docutils literal"><span class="pre">AccessToken</span></tt>s via SSL, add these properties to <tt class="docutils literal"><span class="pre">cdap-security.xml</span></tt>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="20%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Default Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>security.auth.server.ssl.keystore.path</td>
<td>None</td>
<td>Keystore file location; the file should
be owned and readable only by the
CDAP user</td>
</tr>
<tr class="row-odd"><td>security.auth.server.ssl.keystore.password</td>
<td>None</td>
<td>Keystore password</td>
</tr>
<tr class="row-even"><td>security.auth.server.ssl.keystore.keypassword</td>
<td>None</td>
<td>Keystore key password</td>
</tr>
<tr class="row-odd"><td>security.auth.server.ssl.keystore.type</td>
<td>JKS</td>
<td>Keystore file type</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configuring-ssl-for-the-router">
<h3>Configuring SSL for the Router<a class="headerlink" href="#configuring-ssl-for-the-router" title="Permalink to this headline">¶</a></h3>
<p>To configure SSL for the Router, add these properties to <tt class="docutils literal"><span class="pre">cdap-security.xml</span></tt>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="20%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Default Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>router.ssl.keystore.path</td>
<td>None</td>
<td>Keystore file location; the file should
be owned and readable only by the
CDAP user</td>
</tr>
<tr class="row-odd"><td>router.ssl.keystore.password</td>
<td>None</td>
<td>Keystore password</td>
</tr>
<tr class="row-even"><td>router.ssl.keystore.keypassword</td>
<td>None</td>
<td>Keystore key password</td>
</tr>
<tr class="row-odd"><td>router.ssl.keystore.type</td>
<td>JKS</td>
<td>Keystore file type</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configuring-ssl-for-ui">
<h3>Configuring SSL for UI<a class="headerlink" href="#configuring-ssl-for-ui" title="Permalink to this headline">¶</a></h3>
<p>To enable SSL for the Web-UI, add these properties to <tt class="docutils literal"><span class="pre">cdap-security.xml</span></tt>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Default Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>dashboard.ssl.cert</td>
<td>SSL cert file location; the file should
be owned and readable only by the CDAP user</td>
</tr>
<tr class="row-odd"><td>dashboard.ssl.key</td>
<td>SSL key file location; the file should
be owned and readable only by the CDAP user</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> To allow self signed certificates, set dashboard.ssl.disable.cert.check field to true in cdap-site.xml</p>
</div>
<div class="section" id="enabling-access-logging">
<span id="enable-access-logging"></span><h3>Enabling Access Logging<a class="headerlink" href="#enabling-access-logging" title="Permalink to this headline">¶</a></h3>
<p>To enable access logging, add the following to <tt class="docutils literal"><span class="pre">logback.xml</span></tt> (typically under <tt class="docutils literal"><span class="pre">/etc/cdap/conf/</span></tt>)</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">&lt;appender name=&quot;AUDIT&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;</span>
<span class="go">  &lt;file&gt;access.log&lt;/file&gt;</span>
<span class="go">  &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span>
<span class="go">    &lt;fileNamePattern&gt;access.log.%d{yyyy-MM-dd}&lt;/fileNamePattern&gt;</span>
<span class="go">    &lt;maxHistory&gt;30&lt;/maxHistory&gt;</span>
<span class="go">  &lt;/rollingPolicy&gt;</span>
<span class="go">  &lt;encoder&gt;</span>
<span class="go">    &lt;pattern&gt;%msg%n&lt;/pattern&gt;</span>
<span class="go">  &lt;/encoder&gt;</span>
<span class="go">&lt;/appender&gt;</span>
<span class="go">&lt;logger name=&quot;http-access&quot; level=&quot;TRACE&quot; additivity=&quot;false&quot;&gt;</span>
<span class="go">  &lt;appender-ref ref=&quot;AUDIT&quot; /&gt;</span>
<span class="go">&lt;/logger&gt;</span>

<span class="go">&lt;appender name=&quot;EXTERNAL_AUTH_AUDIT&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;</span>
<span class="go">  &lt;file&gt;external_auth_access.log&lt;/file&gt;</span>
<span class="go">  &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span>
<span class="go">    &lt;fileNamePattern&gt;external_auth_access.log.%d{yyyy-MM-dd}&lt;/fileNamePattern&gt;</span>
<span class="go">    &lt;maxHistory&gt;30&lt;/maxHistory&gt;</span>
<span class="go">  &lt;/rollingPolicy&gt;</span>
<span class="go">  &lt;encoder&gt;</span>
<span class="go">    &lt;pattern&gt;%msg%n&lt;/pattern&gt;</span>
<span class="go">  &lt;/encoder&gt;</span>
<span class="go">&lt;/appender&gt;</span>
<span class="go">&lt;logger name=&quot;external-auth-access&quot; level=&quot;TRACE&quot; additivity=&quot;false&quot;&gt;</span>
<span class="go">  &lt;appender-ref ref=&quot;EXTERNAL_AUTH_AUDIT&quot; /&gt;</span>
<span class="go">&lt;/logger&gt;</span>
</pre></div>
</div>
<p>You may also configure the file being logged to by changing the path under <tt class="docutils literal"><span class="pre">&lt;file&gt;...&lt;/file&gt;</span></tt>.</p>
</div>
</div>
<div class="section" id="configuring-authentication-mechanisms">
<h2>Configuring Authentication Mechanisms<a class="headerlink" href="#configuring-authentication-mechanisms" title="Permalink to this headline">¶</a></h2>
<p>CDAP provides several ways to authenticate a clients’s identity:</p>
<ul class="simple">
<li><a class="reference internal" href="#installation-basic-authentication"><em>Basic Authentication</em></a></li>
<li><a class="reference internal" href="#installation-ldap-authentication"><em>LDAP Authentication</em></a></li>
<li><a class="reference internal" href="#installation-jaspi-authentication"><em>JASPI Authentication</em></a></li>
<li><a class="reference internal" href="#installation-custom-authentication"><em>Custom Authentication</em></a></li>
</ul>
<div class="section" id="basic-authentication">
<span id="installation-basic-authentication"></span><h3>Basic Authentication<a class="headerlink" href="#basic-authentication" title="Permalink to this headline">¶</a></h3>
<p>The simplest way to identity a client is to authenticate against a realm file.
To configure basic authentication add the following properties to <tt class="docutils literal"><span class="pre">cdap-site.xml</span></tt>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>security.authentication.handlerClassName</td>
<td>co.cask.cdap.security.server.BasicAuthenticationHandler</td>
</tr>
<tr class="row-odd"><td>security.authentication.basic.realmfile</td>
<td>&lt;path&gt;</td>
</tr>
</tbody>
</table>
<p>The realm file is of the following format:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">username: password[,rolename ...]</span>
</pre></div>
</div>
<p>Note that it is not advisable to use this method of authentication. In production, we recommend using any of the
other methods described below.</p>
</div>
<div class="section" id="ldap-authentication">
<span id="installation-ldap-authentication"></span><h3>LDAP Authentication<a class="headerlink" href="#ldap-authentication" title="Permalink to this headline">¶</a></h3>
<p>You can configure CDAP to authenticate against an LDAP instance by adding these
properties to <tt class="docutils literal"><span class="pre">cdap-site.xml</span></tt>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>security.authentication.handlerClassName</td>
<td>co.cask.cdap.security.server.LDAPAuthenticationHandler</td>
</tr>
<tr class="row-odd"><td>security.authentication.loginmodule.className</td>
<td>co.cask.cdap.security.server.LdapLoginModule</td>
</tr>
<tr class="row-even"><td>security.authentication.handler.debug</td>
<td>true/false</td>
</tr>
<tr class="row-odd"><td>security.authentication.handler.hostname</td>
<td>&lt;hostname&gt;</td>
</tr>
<tr class="row-even"><td>security.authentication.handler.port</td>
<td>&lt;port&gt;</td>
</tr>
<tr class="row-odd"><td>security.authentication.handler.userBaseDn</td>
<td>&lt;userBaseDn&gt;</td>
</tr>
<tr class="row-even"><td>security.authentication.handler.userRdnAttribute</td>
<td>&lt;userRdnAttribute&gt;</td>
</tr>
<tr class="row-odd"><td>security.authentication.handler.userObjectClass</td>
<td>&lt;userObjectClass&gt;</td>
</tr>
</tbody>
</table>
<p>In addition, you may configure these optional properties in <tt class="docutils literal"><span class="pre">cdap-site.xml</span></tt>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>security.authentication.handler.bindDn</td>
<td>&lt;bindDn&gt;</td>
</tr>
<tr class="row-odd"><td>security.authentication.handler.bindPassword</td>
<td>&lt;bindPassword&gt;</td>
</tr>
<tr class="row-even"><td>security.authentication.handler.userIdAttribute</td>
<td>&lt;userIdAttribute&gt;</td>
</tr>
<tr class="row-odd"><td>security.authentication.handler.userPasswordAttribute</td>
<td>&lt;userPasswordAttribute&gt;</td>
</tr>
<tr class="row-even"><td>security.authentication.handler.roleBaseDn</td>
<td>&lt;roleBaseDn&gt;</td>
</tr>
<tr class="row-odd"><td>security.authentication.handler.roleNameAttribute</td>
<td>&lt;roleNameAttribute&gt;</td>
</tr>
<tr class="row-even"><td>security.authentication.handler.roleMemberAttribute</td>
<td>&lt;roleMemberAttribute&gt;</td>
</tr>
<tr class="row-odd"><td>security.authentication.handler.roleObjectClass</td>
<td>&lt;roleObjectClass&gt;</td>
</tr>
</tbody>
</table>
<p>To enable SSL between the authentication server and the LDAP instance, configure
these properties in <tt class="docutils literal"><span class="pre">cdap-site.xml</span></tt>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="15%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Value</th>
<th class="head">Default Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>security.authentication.handler.useLdaps</td>
<td>true/false</td>
<td>false</td>
</tr>
<tr class="row-odd"><td>security.authentication.handler.ldapsVerifyCertificate</td>
<td>true/false</td>
<td>true</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="jaspi-authentication">
<span id="installation-jaspi-authentication"></span><h3>JASPI Authentication<a class="headerlink" href="#jaspi-authentication" title="Permalink to this headline">¶</a></h3>
<p>To authenticate a user using JASPI (Java Authentication Service Provider Interface) add
the following properties to <tt class="docutils literal"><span class="pre">cdap-site.xml</span></tt>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>security.authentication.handlerClassName</td>
<td>co.cask.cdap.security.server.JASPIAuthenticationHandler</td>
</tr>
<tr class="row-odd"><td>security.authentication.loginmodule.className</td>
<td>&lt;custom-login-module&gt;</td>
</tr>
</tbody>
</table>
<p>In addition, any properties with the prefix <tt class="docutils literal"><span class="pre">security.authentication.handler.</span></tt>,
such as <tt class="docutils literal"><span class="pre">security.authentication.handler.hostname</span></tt>, will be provided to the handler.
These properties, stripped off the prefix, will be used to instantiate the <tt class="docutils literal"><span class="pre">javax.security.auth.login.Configuration</span></tt> used
by the <tt class="docutils literal"><span class="pre">LoginModule</span></tt>.</p>
</div>
<div class="section" id="custom-authentication">
<span id="installation-custom-authentication"></span><h3>Custom Authentication<a class="headerlink" href="#custom-authentication" title="Permalink to this headline">¶</a></h3>
<p>To use a Custom Authentication mechanism, set the
<tt class="docutils literal"><span class="pre">security.authentication.handlerClassName</span></tt> in <tt class="docutils literal"><span class="pre">cdap-site.xml</span></tt> with the custom
handler&#8217;s classname. Any properties set in <tt class="docutils literal"><span class="pre">cdap-site.xml</span></tt> are available through a
<tt class="docutils literal"><span class="pre">CConfiguration</span></tt> object and can be used to configure the handler.</p>
<p>To make your custom handler class available to the authentication service, copy your
packaged jar file (and any additional dependency jars) to the <tt class="docutils literal"><span class="pre">security/lib/</span></tt> directory
within your CDAP installation (typically under <tt class="docutils literal"><span class="pre">/opt/cdap</span></tt>).</p>
<p>The Developers’ Manual <a class="reference external" href="../source/../../developers-manual/security/custom-authentication.html#custom-authentication" title="(in Cask Data Application Platform v2.5.2)"><em class="xref std std-ref">Custom Authentication</em></a> section shows
how to create a Custom Authentication Mechanism.</p>
</div>
</div>
<div class="section" id="testing-security">
<h2>Testing Security<a class="headerlink" href="#testing-security" title="Permalink to this headline">¶</a></h2>
<p>From here on out we will use:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">&lt;base-url&gt;</span>
</pre></div>
</div>
<p>to represent the base URL that clients can use for the HTTP REST API:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">http://&lt;host&gt;:&lt;port&gt;</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">&lt;base-auth-url&gt;</span>
</pre></div>
</div>
<p>to represent the base URL that clients can use for obtaining access tokens:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">http://&lt;host&gt;:&lt;auth-port&gt;</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">&lt;host&gt;</span></tt> is the host name of the CDAP server, <tt class="docutils literal"><span class="pre">&lt;port&gt;</span></tt> is the port that is set as the <tt class="docutils literal"><span class="pre">router.bind.port</span></tt>
in <tt class="docutils literal"><span class="pre">cdap-site.xml</span></tt> (default: <tt class="docutils literal"><span class="pre">10000</span></tt>), and <tt class="docutils literal"><span class="pre">&lt;auth-port&gt;</span></tt> is the port that is set as the
<tt class="docutils literal"><span class="pre">security.auth.server.bind.port</span></tt> (default: <tt class="docutils literal"><span class="pre">10009</span></tt>).</p>
<p>Note that if SSL is enabled for CDAP, then the base URL uses <tt class="docutils literal"><span class="pre">https</span></tt>, <tt class="docutils literal"><span class="pre">&lt;port&gt;</span></tt> becomes the port that is set
as the <tt class="docutils literal"><span class="pre">router.ssl.bind.port</span></tt> in <tt class="docutils literal"><span class="pre">cdap-site.xml</span></tt> (default: <tt class="docutils literal"><span class="pre">10443</span></tt>), and <tt class="docutils literal"><span class="pre">&lt;auth-port&gt;</span></tt> becomes the port that
is set as the <tt class="docutils literal"><span class="pre">security.auth.server.ssl.bind.port</span></tt> (default: <tt class="docutils literal"><span class="pre">10010</span></tt>).</p>
<p>To ensure that you&#8217;ve configured security correctly, run these simple tests to verify that the
security components are working as expected:</p>
<ul>
<li><p class="first">After configuring CDAP as described above, restart CDAP and attempt to use a service:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">curl -v &lt;base-url&gt;/apps</span>
</pre></div>
</div>
</li>
<li><p class="first">This should return a 401 Unauthorized response. Submit a username and password to obtain an <tt class="docutils literal"><span class="pre">AccessToken</span></tt>:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">curl -v -u username:password &lt;base-auth-url&gt;/token</span>
</pre></div>
</div>
</li>
<li><p class="first">This should return a 200 OK response with the <tt class="docutils literal"><span class="pre">AccessToken</span></tt> string in the response body.
Reattempt the first command, but this time include the <tt class="docutils literal"><span class="pre">AccessToken</span></tt> as a header in the command:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">curl -v -H &quot;Authorization: Bearer &lt;AccessToken&gt;&quot; &lt;base-url&gt;/apps</span>
</pre></div>
</div>
</li>
<li><p class="first">This should return a 200 OK response.</p>
</li>
<li><p class="first">Visiting the CDAP Console should redirect you to a login page that prompts for credentials.
Entering the credentials should let you work with the CDAP Console as normal.</p>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div role="note" aria-label="manuals links">
    <h3>CDAP Documentation</h3>
    <ul class="this-page-menu">
      <li><a href="../table-of-contents/../../developers-manual/index.html"
            rel="nofollow">Developers’ Manual</a></li>
      <li><a href="../table-of-contents/../../reference-manual/index.html"
            rel="nofollow">Reference Manual</a></li>
      <li><b><a href="../table-of-contents/../../admin-manual/index.html"
            rel="nofollow">Administration Manual</a></b></li>
      <li><a href="../table-of-contents/../../examples-manual/index.html"
            rel="nofollow">Examples, Guides, and Tutorials</a></li>
      <li><a href="../table-of-contents/../../reference-manual/release-notes.html"
            rel="nofollow">Release Notes</a></li>
      <li><a href="../table-of-contents/../../reference-manual/glossary.html"
            rel="nofollow">Glossary</a></li>
      <li><a href="../table-of-contents/../../reference-manual/faq.html"
            rel="nofollow">FAQ</a></li>
    </ul>
   </div><!--
  Copyright © 2014 Cask Data, Inc.

  Licensed under the Apache License, Version 2.0 (the "License"); you may not
  use this file except in compliance with the License. You may obtain a copy of
  the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
  License for the specific language governing permissions and limitations under
  the License.
-->

<h3 class="pagenavtitle"><a href="../table-of-contents.html">Administration Manual: Table&nbsp;of&nbsp;Contents</a></h3>
<nav class="pagenav">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html"> Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html"> Installation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html"> Installation and Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href=""> Security</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#enabling-security">Enabling Security</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-authentication-mechanisms">Configuring Authentication Mechanisms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-security">Testing Security</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="monitoring.html"> Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdap-site.html"> Appendix: cdap-site.xml</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdap-security.html"> Appendix: cdap-security.xml</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../operations/index.html"> Operations</a></li>
</ul>

</nav>
  <h4>Previous Topic</h4>
  <p class="topless"><a href="installation.html"
                        title="Previous Chapter">Installation and Configuration</a></p>
  <h4>Next Topic</h4>
  <p class="topless"><a href="monitoring.html"
                        title="Next Chapter">Monitoring CDAP</a></p>
  <div role="note" aria-label="downloads links">
    <h3>Downloads</h3>
    <ul class="this-page-menu">
      <li><a href="http://docs.cask.co/cdap/2.5.2/cdap-docs-2.5.2-web.zip"
            rel="nofollow">Zip Archive of CDAP Documentation</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick Search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;margin:0px auto;}
.tg td{padding:0px 20px 0px 20px;border-width:0px;overflow:hidden;word-break:normal;font-weight:normal;}
.tg th{padding:0px 20px 0px 20px;border-width:0px;overflow:hidden;word-break:normal;font-weight:normal;}
.tg .tg-s6z2{text-align:center;}
.tg .tg-0ord{text-align:right;}
.tg a{font-weight:bold;}
</style>
<table class="tg" width= 100%>
  <tr>
    <th class="tg-031e">Previous Topic: 
    <a title="Installation and Configuration" href="installation.html" />Installation and Configuration</a>&nbsp;&nbsp;
    
    </th>
    <th class="tg-s6z2">
        &copy; Copyright 2014 Cask Data, Inc.
    
    </th>
    <th class="tg-0ord">&nbsp;&nbsp;Next Topic:
    <a title="Monitoring CDAP" href="monitoring.html" />Monitoring CDAP</a>
    
    </th>
  </tr>
</table>

    </div>
  </body>
</html>