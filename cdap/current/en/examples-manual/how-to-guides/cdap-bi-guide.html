<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Cask Data, Inc." name="author" />
<meta content="Copyright © 2014 Cask Data, Inc." name="copyright" />
<script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-55081520-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <title>Analyzing CDAP Data from BI Tools &mdash; Cask Data Application Platform 2.5.2 Documentation</title>
    
    <link rel="stylesheet" href="../_static/cdap.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    



    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.5.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Cask Data Application Platform 2.5.2 Documentation" href="../index.html" />
    <link rel="up" title="How-To Guides" href="index.html" />
    <link rel="next" title="Storing Timeseries Data" href="cdap-timeseries-guide.html" />
    <link rel="prev" title="Batch Data Processing With CDAP" href="cdap-mapreduce-guide.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="cdap-timeseries-guide.html" title="Storing Timeseries Data"
             accesskey="N">Next</a> |</li>
        <li class="right" >
          <a href="cdap-mapreduce-guide.html" title="Batch Data Processing With CDAP"
             accesskey="P">Previous</a> |</li>
        <li><a href="../table-of-contents.html">CDAP Examples, Guides, and Tutorials</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">How-To Guides</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="analyzing-cdap-data-from-bi-tools">
<span id="cdap-bi-guide"></span><h1>Analyzing CDAP Data from BI Tools<a class="headerlink" href="#analyzing-cdap-data-from-bi-tools" title="Permalink to this headline">¶</a></h1>
<blockquote class="pull-quote">
<div><strong>Source Code Repository:</strong> Source code (and other resources) for this guide are available at the
<a class="reference external" href="https://github.com/cdap-guides/cdap-bi-guide">CDAP Guides GitHub repository</a>.</div></blockquote>
<p>Cask Data Application Platform (CDAP) provides an abstraction—
<a class="reference external" href="http://docs.cdap.io/cdap/current/en/developers-manual/building-blocks/datasets/index.html">Datasets</a>
—to store data. In this guide, you will learn how to integrate and
analyze Datasets with BI (Business Intelligence) Tools.</p>
<div class="section" id="what-you-will-build">
<h2>What You Will Build<a class="headerlink" href="#what-you-will-build" title="Permalink to this headline">¶</a></h2>
<p>This guide will take you through building a <a class="reference external" href="http://docs.cdap.io/cdap/current/en/developers-manual/building-blocks/applications.html">CDAP
application</a>
that processes purchase events from a
<a class="reference external" href="http://docs.cdap.io/cdap/current/en/developers-manual/building-blocks/streams.html">Stream,</a>
persists the results in a Dataset, and then analyzes them using a BI
tool. You will:</p>
<ul class="simple">
<li>Build a CDAP Application that consumes purchase events from a Stream
and stores them in a
<a class="reference external" href="http://docs.cdap.io/cdap/current/en/developers-manual/building-blocks/datasets/index.html">Dataset;</a></li>
<li>Build a
<a class="reference external" href="http://docs.cdap.io/cdap/current/en/developers-manual/building-blocks/flows-flowlets/flowlets.html">Flowlet</a>
that processes purchase events in realtime, writing the events into a
Dataset; and</li>
<li>Finally, access this Dataset from a BI tool to run queries by joining
purchase events in the Dataset with a product catalog—a local data
source in the BI tool.</li>
</ul>
</div>
<div class="section" id="what-you-will-need">
<h2>What You Will Need<a class="headerlink" href="#what-you-will-need" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">JDK 6 or JDK
7</a></li>
<li><a class="reference external" href="http://maven.apache.org/">Apache Maven 3.0+</a></li>
<li><a class="reference external" href="http://docs.cdap.io/cdap/current/en/developers-manual/getting-started/standalone/index.html">CDAP
SDK</a></li>
<li><a class="reference external" href="http://community.pentaho.com/">Pentaho Data Integration</a></li>
</ul>
</div>
<div class="section" id="lets-build-it">
<h2>Let’s Build It!<a class="headerlink" href="#lets-build-it" title="Permalink to this headline">¶</a></h2>
<p>The following sections will guide you through building an application
from scratch. If you are interested in deploying and running the
application right away, you can clone its source code and binaries from
this GitHub repository. In that case, feel free to skip the next two
sections and jump right to the <a class="reference external" href="#build-and-run-application">Build and Run
Application</a> section.</p>
<div class="section" id="application-design">
<h3>Application Design<a class="headerlink" href="#application-design" title="Permalink to this headline">¶</a></h3>
<p>In this example, we will learn how to explore purchase events using the
<em>Pentaho</em> BI Tool. We can ask questions such as <em>&#8220;What is the total
spend of a customer for a given day?&#8221;</em></p>
<div class="figure">
<img alt="" src="../_images/app-design.png" />
</div>
<p>A purchase event consists of:</p>
<ul class="simple">
<li>Customer</li>
<li>Quantity purchased</li>
<li>Product</li>
</ul>
<p>Purchase events are injected into the <tt class="docutils literal"><span class="pre">purchases</span></tt> Stream. The <tt class="docutils literal"><span class="pre">sink</span></tt>
Flowlet reads events from the Stream and writes them into the
<tt class="docutils literal"><span class="pre">PurchasesDataset</span></tt>. The <tt class="docutils literal"><span class="pre">PurchasesDataset</span></tt> has Hive integration
enabled and can be queried, like any regular Database table, from a BI
tool by using the <a class="reference external" href="http://docs.cdap.io/cdap/current/en/developers-manual/advanced/data-exploration.html#connecting-to-cdap-datasets-using-cdap-jdbc-driver">CDAP JDBC
Driver.</a></p>
</div>
<div class="section" id="implementation">
<h3>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h3>
<p>The first step is to get our application structure set up. We will use a
standard Maven project structure for all of the source code files:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">./pom.xml</span>
<span class="go">./src/main/java/co/cask/cdap/guides/purchase/Purchase.java</span>
<span class="go">./src/main/java/co/cask/cdap/guides/purchase/PurchaseApp.java</span>
<span class="go">./src/main/java/co/cask/cdap/guides/purchase/PurchaseFlow.java</span>
<span class="go">./src/main/java/co/cask/cdap/guides/purchase/PurchaseSinkFlowlet.java</span>
<span class="go">./src/main/java/co/cask/cdap/guides/purchase/PurchaseStore.java</span>
</pre></div>
</div>
<p>The application is identified by the <tt class="docutils literal"><span class="pre">PurchaseApp</span></tt> class. This class
extends
<a class="reference external" href="http://docs.cdap.io/cdap/current/en/reference-manual/javadocs/co/cask/cdap/api/app/AbstractApplication.html">AbstractApplication</a>,
and overrides the <tt class="docutils literal"><span class="pre">configure()</span></tt> method to define all of the
application components:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PurchaseApp</span> <span class="kd">extends</span> <span class="n">AbstractApplication</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">APP_NAME</span> <span class="o">=</span> <span class="s">&quot;PurchaseApp&quot;</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">setName</span><span class="o">(</span><span class="n">APP_NAME</span><span class="o">);</span>
    <span class="n">addStream</span><span class="o">(</span><span class="k">new</span> <span class="n">Stream</span><span class="o">(</span><span class="s">&quot;purchases&quot;</span><span class="o">));</span>
    <span class="n">addFlow</span><span class="o">(</span><span class="k">new</span> <span class="n">PurchaseFlow</span><span class="o">());</span>
    <span class="n">createDataset</span><span class="o">(</span><span class="s">&quot;PurchasesDataset&quot;</span><span class="o">,</span> <span class="n">PurchaseStore</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">PurchaseStore</span><span class="o">.</span><span class="na">properties</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>When it comes to handling time-based events, we need a place to receive
and process the events themselves. CDAP provides a real-time stream
processing system that is a great match for handling event streams.
After first setting the application name, our <tt class="docutils literal"><span class="pre">PurchaseApp</span></tt> adds a new
Stream, called <tt class="docutils literal"><span class="pre">purchases</span></tt>.</p>
<p>We also need a place to store the purchase event records that we
receive; <tt class="docutils literal"><span class="pre">PurchaseApp</span></tt> next creates a Dataset to store the processed
data. <tt class="docutils literal"><span class="pre">PurchaseApp</span></tt> uses an
<a class="reference external" href="http://docs.cdap.io/cdap/current/en/reference-manual/javadocs/co/cask/cdap/api/dataset/lib/ObjectStore.html">ObjectStore</a>
Dataset to store the purchase events. The purchase events are
represented as a Java class, <tt class="docutils literal"><span class="pre">Purchase</span></tt>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Purchase</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">customer</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">product</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">purchaseTime</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Purchase</span><span class="o">(</span><span class="n">String</span> <span class="n">customer</span><span class="o">,</span> <span class="n">String</span> <span class="n">product</span><span class="o">,</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">,</span> <span class="kt">long</span> <span class="n">purchaseTime</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">customer</span> <span class="o">=</span> <span class="n">customer</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">product</span> <span class="o">=</span> <span class="n">product</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">quantity</span> <span class="o">=</span> <span class="n">quantity</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">purchaseTime</span> <span class="o">=</span> <span class="n">purchaseTime</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getCustomer</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">customer</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getPurchaseTime</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">purchaseTime</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getQuantity</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">quantity</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getProduct</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">product</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getKey</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">hashedKey</span> <span class="o">=</span> <span class="n">purchaseTime</span> <span class="o">+</span> <span class="n">customer</span> <span class="o">+</span> <span class="n">product</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">hashedKey</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>PurchaseApp adds a <tt class="docutils literal"><span class="pre">PurchaseFlow</span></tt> to process data from the Stream and
store it into the Dataset:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PurchaseFlow</span> <span class="kd">implements</span> <span class="n">Flow</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">FlowSpecification</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">FlowSpecification</span><span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">with</span><span class="o">()</span>
      <span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&quot;PurchaseFlow&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="s">&quot;Reads purchase events from a stream and stores the purchases in a Dataset&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">withFlowlets</span><span class="o">()</span>
        <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;sink&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">PurchaseSinkFlowlet</span><span class="o">())</span>
      <span class="o">.</span><span class="na">connect</span><span class="o">()</span>
        <span class="o">.</span><span class="na">fromStream</span><span class="o">(</span><span class="s">&quot;purchases&quot;</span><span class="o">).</span><span class="na">to</span><span class="o">(</span><span class="s">&quot;sink&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">build</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">PurchaseFlow</span></tt> contains a <tt class="docutils literal"><span class="pre">PurchaseSinkFlowlet</span></tt> that writes to
the Dataset:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PurchaseSinkFlowlet</span> <span class="kd">extends</span> <span class="n">AbstractFlowlet</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">LOG</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">PurchaseSinkFlowlet</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

  <span class="nd">@UseDataSet</span><span class="o">(</span><span class="s">&quot;PurchasesDataset&quot;</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">PurchaseStore</span> <span class="n">store</span><span class="o">;</span>

  <span class="nd">@ProcessInput</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">StreamEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">Charsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getBody</span><span class="o">()).</span><span class="na">toString</span><span class="o">();</span>
    <span class="c1">// &lt;customer&gt;,&lt;quantity&gt;,&lt;productId&gt;</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">tokens</span> <span class="o">=</span>  <span class="n">body</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tokens</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">tokens</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">tokens</span><span class="o">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">LOG</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;Invalid stream event:{}&quot;</span><span class="o">,</span> <span class="n">body</span><span class="o">);</span>
      <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">String</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
    <span class="kt">int</span> <span class="n">quantity</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">tokens</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="n">String</span> <span class="n">item</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>

    <span class="n">Purchase</span> <span class="n">purchase</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Purchase</span><span class="o">(</span><span class="n">customer</span><span class="o">,</span> <span class="n">item</span><span class="o">,</span> <span class="n">quantity</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
    <span class="n">store</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">purchase</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">PurchaseStore</span></tt> is a custom dataset that implements the
<tt class="docutils literal"><span class="pre">RecordScannable</span></tt> interface for integration with Hive:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PurchaseStore</span> <span class="kd">extends</span> <span class="n">AbstractDataset</span> <span class="kd">implements</span> <span class="n">RecordScannable</span><span class="o">&lt;</span><span class="n">Purchase</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">ObjectStore</span><span class="o">&lt;</span><span class="n">Purchase</span><span class="o">&gt;</span> <span class="n">store</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">DatasetProperties</span> <span class="nf">properties</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">ObjectStores</span><span class="o">.</span><span class="na">objectStoreProperties</span><span class="o">(</span><span class="n">Purchase</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">DatasetProperties</span><span class="o">.</span><span class="na">EMPTY</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnsupportedTypeException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">&quot;This should never be thrown - Purchase is a supported type&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nf">PurchaseStore</span><span class="o">(</span><span class="n">DatasetSpecification</span> <span class="n">spec</span><span class="o">,</span>
                       <span class="nd">@EmbeddedDataset</span><span class="o">(</span><span class="s">&quot;store&quot;</span><span class="o">)</span> <span class="n">ObjectStore</span><span class="o">&lt;</span><span class="n">Purchase</span><span class="o">&gt;</span> <span class="n">objStore</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">spec</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">objStore</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">store</span> <span class="o">=</span> <span class="n">objStore</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Type</span> <span class="nf">getRecordType</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Purchase</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Split</span><span class="o">&gt;</span> <span class="nf">getSplits</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">store</span><span class="o">.</span><span class="na">getSplits</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">RecordScanner</span><span class="o">&lt;</span><span class="n">Purchase</span><span class="o">&gt;</span> <span class="nf">createSplitRecordScanner</span><span class="o">(</span><span class="n">Split</span> <span class="n">split</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Scannables</span><span class="o">.</span><span class="na">valueRecordScanner</span><span class="o">(</span><span class="n">store</span><span class="o">.</span><span class="na">createSplitReader</span><span class="o">(</span><span class="n">split</span><span class="o">));</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">write</span><span class="o">(</span><span class="n">Purchase</span> <span class="n">purchase</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">store</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">purchase</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="n">purchase</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">Purchase</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">store</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="build-and-run-application">
<h2>Build and Run Application<a class="headerlink" href="#build-and-run-application" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">PurchaseApp</span></tt> application can be built and packaged using the
Apache Maven command from the project directory:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">mvn clean package</span>
</pre></div>
</div>
<p>Note that the remaining commands assume that the <tt class="docutils literal"><span class="pre">cdap-cli.sh</span></tt> script
is available on your PATH. If this is not the case, please add it:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">export PATH=$PATH:&lt;CDAP home&gt;/bin</span>
</pre></div>
</div>
<p>If you haven&#8217;t already started a standalone CDAP installation, start it
with the command:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">cdap.sh start</span>
</pre></div>
</div>
<p>We can then deploy the application to a running standalone CDAP
installation:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">cdap-cli.sh deploy app target/cdap-bi-guide-1.0.0.jar</span>
<span class="go">cdap-cli.sh start flow PurchaseApp.PurchaseFlow</span>
</pre></div>
</div>
<p>Next, we will send some sample purchase events into the stream for
processing. The purchase event consists of a <tt class="docutils literal"><span class="pre">customer</span> <span class="pre">name</span></tt>, a
<tt class="docutils literal"><span class="pre">quantity</span> <span class="pre">purchased</span></tt> and a <tt class="docutils literal"><span class="pre">product</span> <span class="pre">purchased</span></tt>:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">cdap-cli.sh send stream purchases &quot;Tom,    5,       pear&quot;</span>
<span class="go">cdap-cli.sh send stream purchases &quot;Alice, 12,      apple&quot;</span>
<span class="go">cdap-cli.sh send stream purchases &quot;Alice,  6,     banana&quot;</span>
<span class="go">cdap-cli.sh send stream purchases &quot;Bob,    2,     orange&quot;</span>
<span class="go">cdap-cli.sh send stream purchases &quot;Bob,    1, watermelon&quot;</span>
<span class="go">cdap-cli.sh send stream purchases &quot;Bob,   10,      apple&quot;</span>
</pre></div>
</div>
<p>Now that purchase events have been ingested by CDAP, they can be
explored with a BI tool such as <em>Pentaho Data Integration</em>.</p>
<ol class="arabic">
<li><p class="first">Download <a class="reference external" href="http://community.pentaho.com/">Pentaho Data Integration</a>
and unzip it.</p>
</li>
<li><p class="first">Before opening the <em>Pentaho Data Integration</em> application, copy the
<tt class="docutils literal"><span class="pre">&lt;CDAP</span> <span class="pre">home&gt;/lib/co.cask.cdap.cdap-explore-jdbc-&lt;version&gt;.jar</span></tt> file
from the CDAP SDK to the <tt class="docutils literal"><span class="pre">&lt;data-integration-dir&gt;/lib</span></tt> directory.</p>
</li>
<li><p class="first">Run <em>Pentaho Data Integration</em> by invoking
<tt class="docutils literal"><span class="pre">&lt;data-integration-dir&gt;/spoon.sh</span></tt> from a terminal.</p>
</li>
<li><p class="first">Open <tt class="docutils literal"><span class="pre">&lt;cdap-bi-guide-dir&gt;/resources/total_spend_per_user.ktr</span></tt> using
<em>File</em> -&gt; <em>Open URL</em></p>
<p>This is a <em>Kettle Transformation</em> file exported from Pentaho Data
Integration. This file contains a transformation that calculates the
total spend of a customer based on the previous purchase events. The
transformation has several components or steps:</p>
<ul class="simple">
<li><em>CDAP Purchases Dataset</em> is a step which uses the
<tt class="docutils literal"><span class="pre">PurchasesDataset</span></tt> as an input source. It pulls all of the
stored purchase events from CDAP.</li>
<li>The <em>Product Catalog CSV</em> step is another source of data, which
pulls in a table from a locally defined csv file. This table
contains a mapping of product name to product price, so that we
can put a pricing on the purchase events.</li>
<li>The <em>Join Rows</em> step joins the two data sources on the <tt class="docutils literal"><span class="pre">product</span></tt>
column, hence adding price information to the purchase event.</li>
<li>We use the <em>Product Cost Calculator</em> step to multiply
<tt class="docutils literal"><span class="pre">purchase.quantity</span></tt> by <tt class="docutils literal"><span class="pre">price</span></tt> to get the total cost for the
purchase.</li>
<li>The <em>Sort on Customer</em> sorts all of the rows by customer so that
the next step can aggregate on price.</li>
<li>The <em>Aggregate by Customer</em> groups the rows by customer and
aggregates on the total cost per purchase. This results in a table
that is a mapping from customer name to a total amount spent by
that customer.</li>
</ul>
</li>
<li><p class="first">Double click on the CSV file input step, and change the filename to
point to <tt class="docutils literal"><span class="pre">&lt;cdap-bi-guide-dir&gt;/resources/prices.csv</span></tt></p>
<div class="figure">
<img alt="" src="../_images/edit-csv-input-file.png" />
</div>
</li>
<li><p class="first">To run this transformation, click <em>Action</em> -&gt; <em>Run</em> -&gt; <em>Launch</em>.</p>
</li>
<li><p class="first">Once the transformation has completed execution, click on the
<em>Aggregate by Customer</em> step, and then click on the <em>Preview Data</em>
tab at the bottom to view the total amount spent by each customer.</p>
<div class="figure">
<img alt="" src="../_images/preview-data.png" />
</div>
</li>
</ol>
<p>Congratulations! You have now learned how to analyze CDAP Datasets from
a BI tool. Please continue to experiment and extend this sample
application.</p>
</div>
<div class="section" id="related-topics">
<h2>Related Topics<a class="headerlink" href="#related-topics" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://docs.cask.co/cdap/current/en/developers-manual/advanced/data-exploration.html#connecting-to-cdap-datasets-using-cdap-jdbc-driver">Connecting to CDAP Datasets using CDAP JDBC
driver</a></li>
<li><a class="reference external" href="http://wiki.pentaho.com/display/EAI/Pentaho+Data+Integration+%28Kettle%29+Tutorial">Pentaho Data Integration (Kettle)
Tutorial</a></li>
</ul>
</div>
<div class="section" id="extend-this-example">
<h2>Extend This Example<a class="headerlink" href="#extend-this-example" title="Permalink to this headline">¶</a></h2>
<p>Now that you know how to integrate CDAP Datasets with BI Tools for data
analysis, you can ask questions such as:</p>
<ul class="simple">
<li>How much revenue does a particular product generate in a day?</li>
<li>What are the three most popular products?</li>
</ul>
<p>If you were to add a ZIP code to the initial purchase events, you can
then ask location-based questions such as:</p>
<ul class="simple">
<li>What are the popular products in any location?</li>
<li>Which locations have the highest revenue?</li>
</ul>
</div>
<div class="section" id="share-and-discuss">
<h2>Share and Discuss!<a class="headerlink" href="#share-and-discuss" title="Permalink to this headline">¶</a></h2>
<p>Have a question? Discuss at the <a class="reference external" href="https://groups.google.com/forum/#!forum/cdap-user">CDAP User Mailing
List.</a></p>
</div>
<div class="section" id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h2>
<p>Copyright © 2014 Cask Data, Inc.</p>
<p>Licensed under the Apache License, Version 2.0 (the &#8220;License&#8221;); you may
not use this file except in compliance with the License. You may obtain
a copy of the License at</p>
<p><a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &#8220;AS IS&#8221; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div role="note" aria-label="manuals links">
    <h3>CDAP Documentation</h3>
    <ul class="this-page-menu">
      <li><a href="../table-of-contents/../../developers-manual/index.html"
            rel="nofollow">Developers’ Manual</a></li>
      <li><a href="../table-of-contents/../../reference-manual/index.html"
            rel="nofollow">Reference Manual</a></li>
      <li><a href="../table-of-contents/../../admin-manual/index.html"
            rel="nofollow">Administration Manual</a></li>
      <li><b><a href="../table-of-contents/../../examples-manual/index.html"
            rel="nofollow">Examples, Guides, and Tutorials</a></b></li>
      <li><a href="../table-of-contents/../../reference-manual/release-notes.html"
            rel="nofollow">Release Notes</a></li>
      <li><a href="../table-of-contents/../../reference-manual/glossary.html"
            rel="nofollow">Glossary</a></li>
      <li><a href="../table-of-contents/../../reference-manual/faq.html"
            rel="nofollow">FAQ</a></li>
    </ul>
   </div><!--
  Copyright © 2014 Cask Data, Inc.

  Licensed under the Apache License, Version 2.0 (the "License"); you may not
  use this file except in compliance with the License. You may obtain a copy of
  the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
  License for the specific language governing permissions and limitations under
  the License.
-->

<h3 class="pagenavtitle"><a href="../table-of-contents.html">Examples, Guides, and Tutorials: Table&nbsp;of&nbsp;Contents</a></h3>
<nav class="pagenav">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">How-To Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cdap-flow-guide.html">Realtime Data Processing with a Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdap-flume-guide.html">Ingesting Data into CDAP using Apache Flume</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdap-mapreduce-guide.html">Batch Data Processing With CDAP</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Analyzing CDAP Data from BI Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-you-will-build">What You Will Build</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-you-will-need">What You Will Need</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lets-build-it">Let’s Build It!</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-and-run-application">Build and Run Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#related-topics">Related Topics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extend-this-example">Extend This Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#share-and-discuss">Share and Discuss!</a></li>
<li class="toctree-l3"><a class="reference internal" href="#license">License</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cdap-timeseries-guide.html">Storing Timeseries Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdap-twitter-ingest-guide.html">Consuming Twitter Data in Realtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdap-spark-guide.html">Iterative Data Processing with Apache Spark</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps-packs.html">Apps and Packs</a></li>
</ul>

</nav>
  <h4>Previous Topic</h4>
  <p class="topless"><a href="cdap-mapreduce-guide.html"
                        title="Previous Chapter">Batch Data Processing With CDAP</a></p>
  <h4>Next Topic</h4>
  <p class="topless"><a href="cdap-timeseries-guide.html"
                        title="Next Chapter">Storing Timeseries Data</a></p>
  <div role="note" aria-label="downloads links">
    <h3>Downloads</h3>
    <ul class="this-page-menu">
      <li><a href="http://docs.cask.co/cdap/2.5.2/cdap-docs-2.5.2-web.zip"
            rel="nofollow">Zip Archive of CDAP Documentation</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick Search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;margin:0px auto;}
.tg td{padding:0px 20px 0px 20px;border-width:0px;overflow:hidden;word-break:normal;font-weight:normal;}
.tg th{padding:0px 20px 0px 20px;border-width:0px;overflow:hidden;word-break:normal;font-weight:normal;}
.tg .tg-s6z2{text-align:center;}
.tg .tg-0ord{text-align:right;}
.tg a{font-weight:bold;}
</style>
<table class="tg" width= 100%>
  <tr>
    <th class="tg-031e">Previous Topic: 
    <a title="Batch Data Processing With CDAP" href="cdap-mapreduce-guide.html" />Batch Data Processing With CDAP</a>&nbsp;&nbsp;
    
    </th>
    <th class="tg-s6z2">
        &copy; Copyright 2014 Cask Data, Inc.
    
    </th>
    <th class="tg-0ord">&nbsp;&nbsp;Next Topic:
    <a title="Storing Timeseries Data" href="cdap-timeseries-guide.html" />Storing Timeseries Data</a>
    
    </th>
  </tr>
</table>

    </div>
  </body>
</html>